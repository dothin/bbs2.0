var myBbsDirectives=angular.module("myBbsDirectives",[]);myBbsDirectives.directive("validatePassword",[function(){return{require:"ngModel",link:function(e,n,t,a){if(a)var r=/^([0-9]*|[A-Z]*|[a-z]*|[^0-9a-zA-Z]*)$/;var c=function(e){var n=a.$isEmpty(e)||!r.test(e);return a.$setValidity("validatePassword",n),n?e:void 0};a.$formatters.push(c),a.$parsers.push(c)}}}]),myBbsDirectives.directive("repeat",[function(){return{restrict:"A",require:"ngModel",link:function(e,n,t,a){if(a){var r=n.inheritedData("$formController")[t.repeat],c=function(e){var n=e===r.$viewValue;return a.$setValidity("repeat",n),n?e:void 0};a.$parsers.push(c),a.$formatters.push(c),r.$parsers.push(function(e){return a.$setValidity("repeat",e===a.$viewValue),e})}}}}]),myBbsDirectives.directive("ckeditor",function(){return{require:"?ngModel",link:function(e,n,t,a){var r=CKEDITOR.replace(n[0],{});a&&(r.on("instanceReady",function(){r.setData(a.$viewValue)}),r.on("pasteState",function(){e.$apply(function(){a.$setViewValue(r.getData())})}),a.$render=function(e){r.setData(a.$viewValue)})}}}),myBbsDirectives.directive("tmPagination",[function(){return{restrict:"EA",template:'<div class="page-list clearfix mb20"><ul class="pagination" ng-show="conf.totalItems > 0"><li ng-class="{disabled: conf.currentPage == 1}" ng-click="prevPage()"><a href="javascript:">&larr;</a></li><li ng-repeat="item in pageList track by $index" ng-class="{active: item == conf.currentPage, separate: item == \'...\'}" ng-click="changeCurrentPage(item)"><a  href="javascript:">{{ item }}</a></li><li ng-class="{disabled: conf.currentPage == conf.numberOfPages}" ng-click="nextPage()"><a  href="javascript:">&rarr;</a></li></ul><div class="page-total hidden-xs" ng-show="conf.totalItems > 0">第<input type="text" ng-model="jumpPageNum"  ng-keyup="jumpToPage($event)"/>页 每页<select ng-model="conf.itemsPerPage" ng-options="option for option in conf.perPageOptions "></select>/共<strong>{{ conf.totalItems }}</strong>条</div><div class="no-items hidden" ng-show="conf.totalItems <= 0">加载中……</div></div>',replace:!0,scope:{conf:"="},link:function(e,n,t){function a(n,t){e.conf.pagesLength=parseInt(e.conf.pagesLength)?parseInt(e.conf.pagesLength):9,e.conf.pagesLength%2===0&&(e.conf.pagesLength=e.conf.pagesLength-1),e.conf.perPageOptions||(e.conf.perPageOptions=[10,15,20,30,50]),e.conf.currentPage=parseInt(e.conf.currentPage)?parseInt(e.conf.currentPage):1,e.conf.totalItems=parseInt(e.conf.totalItems)?parseInt(e.conf.totalItems):0,e.conf.itemsPerPage=parseInt(e.conf.itemsPerPage)?parseInt(e.conf.itemsPerPage):15,e.conf.numberOfPages=Math.ceil(e.conf.totalItems/e.conf.itemsPerPage),e.conf.currentPage<1&&(e.conf.currentPage=1),e.conf.numberOfPages>0&&e.conf.currentPage>e.conf.numberOfPages&&(e.conf.currentPage=e.conf.numberOfPages),e.jumpPageNum=e.conf.currentPage;for(var a,r=e.conf.perPageOptions.length,c=0;r>c;c++)e.conf.perPageOptions[c]==e.conf.itemsPerPage&&(a=!0);if(a||e.conf.perPageOptions.push(e.conf.itemsPerPage),e.conf.perPageOptions.sort(function(e,n){return e-n}),e.pageList=[],e.conf.numberOfPages<=e.conf.pagesLength)for(c=1;c<=e.conf.numberOfPages;c++)e.pageList.push(c);else{var s=(e.conf.pagesLength-1)/2;if(e.conf.currentPage<=s){for(c=1;s+1>=c;c++)e.pageList.push(c);e.pageList.push("..."),e.pageList.push(e.conf.numberOfPages)}else if(e.conf.currentPage>e.conf.numberOfPages-s){for(e.pageList.push(1),e.pageList.push("..."),c=s+1;c>=1;c--)e.pageList.push(Math.ceil(e.conf.numberOfPages-c));e.pageList.push(e.conf.numberOfPages)}else{for(e.pageList.push(1),e.pageList.push("..."),c=Math.ceil(s/2);c>=1;c--)e.pageList.push(e.conf.currentPage-c);for(e.pageList.push(e.conf.currentPage),c=1;s/2>=c;c++)e.pageList.push(e.conf.currentPage+c);e.pageList.push("..."),e.pageList.push(e.conf.numberOfPages)}}e.conf.onChange&&(t!=n&&0===t[0]||e.conf.onChange()),e.$parent.conf=e.conf}e.changeCurrentPage=function(n){"..."!=n&&(e.conf.currentPage=n)},e.prevPage=function(){e.conf.currentPage>1&&(e.conf.currentPage-=1)},e.nextPage=function(){e.conf.currentPage<e.conf.numberOfPages&&(e.conf.currentPage+=1)},e.jumpToPage=function(){e.jumpPageNum=e.jumpPageNum.replace(/[^0-9]/g,""),""!==e.jumpPageNum&&(e.conf.currentPage=e.jumpPageNum)},e.$watch(function(){e.conf.totalItems||(e.conf.totalItems=0);var n=e.conf.totalItems+" "+e.conf.currentPage+" "+e.conf.itemsPerPage;return n},a)}}}]);