var tools={checkLogin:function(e){return!!e.user},goLogin:function(e,t){!this.checkLogin(e)&&t.go("login")},logout:function(e,t,o){e.remove("user"),t.user=e.getObject("user"),localStorage.clear(),o.go("login")},toTwo:function(e){return 10>e?"0"+e:""+e},strToJson:function(e){return JSON.parse(e)},isNumber:function(e){return e===+e},htmlDecode:function(e){var t=document.createElement("a");return t.innerHTML=e,t.textContent},alertSuccess:function(e,t){e.alert=!0,e.isActive=!0,setTimeout(function(){e.alert=!1},2e3),e.alertValue=t},alertError:function(e,t){e.alert=!0,e.isActive=!1,setTimeout(function(){e.alert=!1},2e3),e.alertValue=t}},myBbsCtrls=angular.module("myBbsCtrls",["cfp.loadingBar"]);myBbsCtrls.controller("headerController",["$scope","$rootScope","$cookies","$state","$interval","userServer","alertServer",function(e,t,o,s,a,n,i){e.vm={username:t.user?t.user.name:"",isError:!1,errorInfo:"",tabSwitch:"login",title:"用户登录",noUserCode:!1,remember:!1,searchType:window.localStorage.getItem("searchType")||"帖子",searchText:window.localStorage.getItem("searchText")||"",reg:{action:"reg",username:"",password:"",code:"",repassword:""},login:{action:"login",username:"",password:""},logout:{action:"logout"},useCode:{code:""},getAlert:{action:"getAlert"}};var r=null;$(".collapse .nav a").on("click",function(){$(".collapse").collapse("hide")}),t.isLogin=!!t.user,t.allAlert=0,e.state=s,e.initAlert=function(){i.service(e.vm.getAlert).then(function(o){o.status===!0?(t.allAlert=parseInt(o.no_agree_friend_nums)+parseInt(o.no_read_whispers)+parseInt(o.no_read_message)||0,t.messageAlert=o.no_read_message,t.friendAlert=parseInt(o.no_agree_friend_nums)+parseInt(o.no_read_whispers),e.goRead=function(){t.messageAlert>0&&0==t.friendAlert?s.go("main.user.userMessageList",{},{reload:!0}):0==t.messageAlert&&t.friendAlert>0?s.go("main.user.userFriendList",{},{reload:!0}):s.go("main.user.userInfo",{},{reload:!0}),a.cancel(r)}):t.allAlert=0})},t.isLogin&&(r=a(function(){e.initAlert()},5e3),e.initAlert()),e.goSearch=function(){""!=e.vm.searchText&&(console.log(1),window.localStorage.setItem("searchType",e.vm.searchType),window.localStorage.setItem("searchText",e.vm.searchText),s.go("main.search",{},{reload:!0}))},e.goUserInfo=function(){s.go("main.user.userInfo")},e.changeCheck=function(){e.vm.remember=!e.vm.remember},e.loginShow=function(){e.vm.tabSwitch="login",e.vm.login.username="",e.vm.login.password="",e.vm.reg.code="",e.vm.isError=!1,e.vm.title="用户登录",$("#loginModal").modal("show")},e.regShow=function(){e.vm.reg.username="",e.vm.reg.password="",e.vm.reg.repassword="",e.vm.reg.code="",e.vm.tabSwitch="reg",e.vm.isError=!1,e.vm.title="用户注册",$("#loginModal").modal("show")},e.changeToLogin=function(){e.vm.isError=!1,e.vm.tabSwitch="login",e.vm.title="用户登录"},e.changeToReg=function(){e.vm.isError=!1,e.vm.tabSwitch="reg",e.vm.title="用户注册"},e.reg=function(){e.vm.isError=!1,n.service(e.vm.reg).then(function(s){s.status===!0?(o.putObject("user",{name:s.data.user_name}),t.user=o.getObject("user"),$("#loginModal").modal("hide"),t.isLogin=!0,e.vm.username=t.user.name):(e.vm.isError=!0,e.vm.errorInfo=s.data)})},e.login=function(){e.vm.isError=!1,e.vm.noUserCode&&(e.vm.login.code=e.vm.useCode.code),n.service(e.vm.login).then(function(n){if(console.log(n),n.status===!0){var i=new Date;i.setTime(i.getTime()+2592e6),e.vm.remember?o.putObject("user",{name:n.data.user_name},{expires:i.toUTCString()}):o.putObject("user",{name:n.data.user_name}),t.user=o.getObject("user"),$("#loginModal").modal("hide"),s.go("main.post.postList"),t.isLogin=!0,e.vm.username=t.user.name,r=a(function(){e.initAlert()},5e3),e.initAlert()}else e.vm.isError=!0,e.vm.errorInfo=n.data,n.fail_count>n.conf_fail_count&&(e.vm.noUserCode=!0)},function(){e.vm.isError=!0,e.vm.errorInfo="登录失败，请重试"})},e.logout=function(){n.service(e.vm.logout).then(function(n){n.status===!0?(o.remove("user"),t.user=o.getObject("user"),e.vm.username="",localStorage.clear(),t.isLogin=!1,a.cancel(r),s.go("main.post.postList")):tools.alertError(t,"退出失败")},function(){tools.alertError(t,"退出失败")})},e.enter=function(t){var o=$("#submit");13!=t.keyCode||o.prop("disabled")||e.login()},e.regEnter=function(t){var o=$("#submit");13!=t.keyCode||o.prop("disabled")||e.reg()}}]),myBbsCtrls.controller("postController",["$scope","$rootScope","$cookies","$state","moduleServer","postServer",function(e,t,o,s,a,n){t.vm={post_tile_show:!1},window.localStorage.removeItem("searchType"),window.localStorage.removeItem("searchText")}]),myBbsCtrls.controller("postListController",["$scope","$rootScope","$cookies","$state","moduleServer","postServer",function(e,t,o,s,a,n){e.vm={tableFlag:0,bOff:!0,postList:{},module_id:window.localStorage.getItem("module_id"),module_name:window.localStorage.getItem("module_name"),subNavShow:!!window.localStorage.getItem("module_name"),getPosts:{action:"getPosts",pageIndex:1,pageSize:15},getPostsByModuleId:{action:"getPostsByModuleId",module_id:window.localStorage.getItem("module_id"),pageIndex:1,pageSize:15}},t.vm.post_tile_show=!1,e.init=function(){e.vm.bOff&&(e.vm.bOff=!1,window.localStorage.getItem("module_name")?n.service(e.vm.getPostsByModuleId).then(function(t){t.status===!0?(e.vm.bOff=!0,angular.forEach(t.data,function(e){e.post_time=e.post_time.substring(5)}),e.vm.postList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}):n.service(e.vm.getPosts).then(function(t){t.status===!0?(e.vm.bOff=!0,angular.forEach(t.data,function(e){e.post_time=e.post_time.substring(5)}),e.vm.postList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getPosts.pageIndex=this.currentPage,e.vm.getPosts.pageSize=this.itemsPerPage,e.init()}},e.showAllPost=function(){window.localStorage.removeItem("module_name"),window.localStorage.removeItem("module_id"),e.vm.bOff=!0,e.init(),e.vm.subNavShow=!1},e.goPostDetail=function(e,o){window.localStorage.setItem("post_title",o),window.localStorage.setItem("post_id",e),t.vm.post_title=window.localStorage.getItem("post_title"),s.go("main.post.postDetail")}}]),myBbsCtrls.controller("sendPostController",["$scope","$rootScope","$cookies","$state","moduleServer","postServer",function(e,t,o,s,a,n){e.vm={moduleList:{},getModule:{action:"getAllListNoLimt"},postData:{action:"sendPost",title:"",content:"",type:0}},a.service(e.vm.getModule).then(function(t){if(t.status===!0){e.vm.moduleList=t.data;var o=[];angular.forEach(t.data,function(e){o.push(parseInt(e.module_id))}),e.vm.bigest=Math.max.apply(null,o),e.vm.postData.module=e.vm.bigest}});var i=$("<script></script>");i.attr("src","ckeditor/ckeditor.js").appendTo($("body")),t.vm.post_tile_show=!1,e.sendPost=function(){n.service(e.vm.postData).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),s.go("main.post.postList")):tools.alertError(t,e.data)})}}]),myBbsCtrls.controller("postDetailController",["$scope","$rootScope","$cookies","$sce","$state","moduleServer","postServer","friendServer","whispersServer","messageServer",function(e,t,o,s,a,n,i,r,l,d){e.vm={tableFlag:0,bOff:!0,isUserModule:!1,isMe:!1,isNotJin:!1,isNotRe:!1,isJin:!1,isRe:!1,repostList:{},getModule:{action:"getAllListNoLimt"},getPostDetail:{action:"getPostDetail",post_id:window.localStorage.getItem("post_id")},addCollection:{action:"addCollection",post_id:window.localStorage.getItem("post_id")},addSupport:{action:"addSupport",post_id:window.localStorage.getItem("post_id")},addAgainst:{action:"addAgainst",post_id:window.localStorage.getItem("post_id")},addRepostSupport:{action:"addRepostSupport"},addRepostAgainst:{action:"addRepostAgainst"},addPostComment:{action:"addPostComment",post_id:window.localStorage.getItem("post_id"),repost_content:""},addRepostComment:{action:"addRepostComment",rerepost_content:""},getRepostList:{action:"getRepostList",post_id:window.localStorage.getItem("post_id"),pageIndex:1,pageSize:10},checkIsUserModule:{action:"checkIsUserModule"},checkIsMe:{action:"checkIsMe",post_id:window.localStorage.getItem("post_id")},setJin:{action:"setJin",post_id:window.localStorage.getItem("post_id")},removeJin:{action:"removeJin",post_id:window.localStorage.getItem("post_id")},setRe:{action:"setRe",post_id:window.localStorage.getItem("post_id")},removeRe:{action:"removeRe",post_id:window.localStorage.getItem("post_id")},deletePost:{action:"deletePost",post_id:window.localStorage.getItem("post_id")},updatePost:{action:"updatePost"}},t.vm.post_tile_show=!0,t.vm.post_title=window.localStorage.getItem("post_title"),e.initPost=function(){i.service(e.vm.getPostDetail).then(function(t){t.status===!0&&(e.vm.postDetail=t.data,0==e.vm.postDetail.post_Jin?(e.vm.postDetail.post_Jin="",e.vm.isNotJin=!0):(e.vm.postDetail.post_Jin="精华帖",e.vm.isJin=!0),0==e.vm.postDetail.post_Re?(e.vm.postDetail.post_Re="",e.vm.isNotRe=!0):(e.vm.postDetail.post_Re="热帖",e.vm.isRe=!0),e.vm.postDetail.post_content=tools.htmlDecode(e.vm.postDetail.post_content),e.vm.checkIsUserModule.module_id=t.data.module_id,n.service(e.vm.checkIsUserModule).then(function(t){t.status===!0&&(e.vm.isUserModule=!0)}),i.service(e.vm.checkIsMe).then(function(t){t.status===!0&&(e.vm.isMe=!0)}),e.vm.checkIsMyFriend={action:"checkIsMyFriend",to_user_id:t.data.user_id},r.service(e.vm.checkIsMyFriend).then(function(t){t.status===!0?(e.vm.postDetail.isMyFriend=!0,e.vm.postDetail.isNotMyFriend=!1):(e.vm.postDetail.isMyFriend=!1,e.vm.postDetail.isNotMyFriend=!0)}))})},e.initPost(),e.init=function(){e.vm.bOff&&(e.vm.bOff=!1,i.service(e.vm.getRepostList).then(function(t){t.status===!0?(e.vm.bOff=!0,angular.forEach(t.data,function(e){e.rerepostListShow=null!=e.rerepostList,e.isNotMyFriend=null==e.isNotMyFriend?!0:e.isNotMyFriend}),e.vm.repostList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getRepostList.pageIndex=this.currentPage,e.vm.getRepostList.pageSize=this.itemsPerPage,e.init()}},e.addCollection=function(){i.service(e.vm.addCollection).then(function(o){o.status===!0?(tools.alertSuccess(t,"收藏成功"),e.vm.postDetail.post_collection_num=parseInt(e.vm.postDetail.post_collection_num)+1):tools.alertError(t,o.data)})},e.addSupport=function(){i.service(e.vm.addSupport).then(function(o){o.status===!0?(tools.alertSuccess(t,o.data),e.vm.postDetail.post_support=parseInt(e.vm.postDetail.post_support)+1):tools.alertError(t,o.data)})},e.addAgainst=function(){i.service(e.vm.addAgainst).then(function(o){o.status===!0?(tools.alertSuccess(t,o.data),e.vm.postDetail.post_against=parseInt(e.vm.postDetail.post_against)+1):tools.alertError(t,o.data)})},e.addRepostSupport=function(o,s){e.vm.addRepostSupport.repost_id=o,i.service(e.vm.addRepostSupport).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$(s.target).parents(".detail-main").find(".num1").text(parseInt($(s.target).parents(".detail-main").find(".num1").text())+1)):tools.alertError(t,e.data)})},e.addRepostAgainst=function(o,s){e.vm.addRepostAgainst.repost_id=o,i.service(e.vm.addRepostAgainst).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$(s.target).parents(".detail-main").find(".num2").text(parseInt($(s.target).parents(".detail-main").find(".num2").text())+1)):tools.alertError(t,e.data)})},e.addPostComment=function(){""!=e.vm.addPostComment.repost_content?i.service(e.vm.addPostComment).then(function(o){o.status===!0?(tools.alertSuccess(t,o.data),e.vm.postDetail.post_commentcount=parseInt(e.vm.postDetail.post_commentcount)+1,e.vm.bOff=!0,e.init(),e.vm.addPostComment.repost_content=""):tools.alertError(t,o.data)}):tools.alertError(t,"回帖不得为空")},e.getRerepostForm=function(o,s){e.vm.addRepostComment.repost_id=s;var a=$(o.target),n=a.parent().parent();a.data("flag")===!0?($("#rerepostForm").hide().slideDown().insertBefore(n.find(".rerepostList-box")),a.data("flag",!1)):($("#rerepostForm").slideUp(),a.data("flag",!0)),e.addRepostComment=function(){""!=e.vm.addRepostComment.rerepost_content?e.vm.addRepostComment.rerepost_content.length>256?tools.alertError(t,"不得大于256个字符"):i.service(e.vm.addRepostComment).then(function(o){o.status===!0?(tools.alertSuccess(t,o.data),e.init(),$("#rerepostForm").appendTo($(".detail-wrap")).hide(),e.vm.addRepostComment.rerepost_content=""):tools.alertError(t,o.data)}):tools.alertError(t,"回帖不得为空")}},e.setJin=function(o){e.vm.setJin.module_id=o,i.service(e.vm.setJin).then(function(o){o.status===!0?(tools.alertSuccess(t,"设置成功"),e.vm.isJin=!0,e.vm.isNotJin=!1,e.vm.postDetail.post_Jin="精华帖"):tools.alertError(t,o.data)})},e.setRe=function(o){e.vm.setRe.module_id=o,i.service(e.vm.setRe).then(function(o){o.status===!0?(tools.alertSuccess(t,"设置成功"),e.vm.isRe=!0,e.vm.isNotRe=!1,e.vm.postDetail.post_Re="热帖"):tools.alertError(t,o.data)})},e.removeJin=function(o){e.vm.removeJin.module_id=o,i.service(e.vm.removeJin).then(function(o){o.status===!0?(tools.alertSuccess(t,"设置成功"),e.vm.isNotJin=!0,e.vm.isJin=!1,e.vm.postDetail.post_Jin=""):tools.alertError(t,o.data)})},e.removeRe=function(o){e.vm.removeRe.module_id=o,i.service(e.vm.removeRe).then(function(o){o.status===!0?(tools.alertSuccess(t,"设置成功"),e.vm.isNotRe=!0,e.vm.isRe=!1,e.vm.postDetail.post_Re=""):tools.alertError(t,o.data)})},e.deletePost=function(o){i.service(e.vm.deletePost).then(function(e){e.status===!0?(tools.alertSuccess(t,"删除成功"),a.go("main.post.postList")):tools.alertError(t,e.data)})},e.updatePostModal=function(o,s,a,r,l){$("#updateModal").modal("show"),e.vm.postData={title:s,module_id:a,type:r,content:l},n.service(e.vm.getModule).then(function(t){t.status===!0&&(e.vm.moduleList=t.data,angular.forEach(t.data,function(e){e.module_active=e.module_id==a}))}),e.updatePost=function(){e.vm.updatePost.post_id=o,e.vm.updatePost.post_title=e.vm.postData.title,e.vm.updatePost.module_id=e.vm.postData.module_id,e.vm.updatePost.post_type=e.vm.postData.type,e.vm.updatePost.post_content=e.vm.postData.content,i.service(e.vm.updatePost).then(function(o){o.status===!0?(tools.alertSuccess(t,"修改成功"),$("#updateModal").modal("hide"),e.initPost()):tools.alertError(t,o.data)})}},e.addFriendModalShow=function(o,s){$("#addFriend").modal("show"),e.vm.addFriend={name:s,desc:"跟我交朋友吧",action:"addFriend",to_user_id:o},e.addFriend=function(){""!=e.vm.addFriend.desc?e.vm.addFriend.desc.length>256?tools.alertError(t,"验证信息256字符"):r.service(e.vm.addFriend).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$("#addFriend").modal("hide")):tools.alertError(t,e.data)}):tools.alertError(t,"输入验证信息")}},e.addMessageModalShow=function(o,s){$("#addMessage").modal("show"),e.vm.addMessage={name:s,content:"",action:"addMessage",to_user_id:o},e.addMessage=function(){""!=e.vm.addMessage.content?e.vm.addMessage.content.length>256?tools.alertError(t,"留言不能大于256字符"):d.service(e.vm.addMessage).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$("#addMessage").modal("hide")):tools.alertError(t,e.data)}):tools.alertError(t,"留言不能为空")}},e.addWhispersModalShow=function(o,s){$("#addWhispers").modal("show"),e.vm.addWhispers={name:s,content:"",action:"addWhispers",to_user_id:o},e.addWhispers=function(){""!=e.vm.addWhispers.content?e.vm.addWhispers.content.length>256?tools.alertError(t,"私信不能大于256字符"):l.service(e.vm.addWhispers).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$("#addWhispers").modal("hide")):tools.alertError(t,e.data)}):tools.alertError(t,"私信不能为空")}}}]),myBbsCtrls.controller("userController",["$scope","$rootScope","$cookies","$state","moduleServer","userServer",function(e,t,o,s,a,n){t.vm={user_tile_show:!1},window.localStorage.removeItem("searchType"),window.localStorage.removeItem("searchText")}]),myBbsCtrls.controller("userInfoController",["$scope","$rootScope","$cookies","$state","moduleServer","userServer",function(e,t,o,s,a,n){t.vm={getUserInfo:{action:"getUserInfo"},userInfo:{}},e.init=function(){n.service(e.vm.getUserInfo).then(function(t){t.status===!0&&(e.vm.userInfo=t.data,e.vm.userInfo.user_sexs=0==t.data.user_sex?"男":"女",e.vm.userInfo.user_sign_actives=0==t.data.user_sign_active?"开":"关")})},e.init(),e.userUpdateUserInfoShow=function(a,i,r,l,d,m){$("#userUpdateUser").modal("show"),e.vm.userUpdateUser={action:"userUpdateUser",id:a,name:r,user_face:i,sex:l,password:"",repassword:"",user_sign_active:d,user_signatrue:m},e.userUpdateUser=function(){e.vm.userUpdateUser.face=$("#user_face").val(),n.service(e.vm.userUpdateUser).then(function(a){a.status===!0?(tools.alertSuccess(t,"修改成功"),e.init(),e.vm.userUpdateUser.name!=e.user.name&&(e.vm.logout={action:"logout"},n.service(e.vm.logout).then(function(a){a.status===!0?(o.remove("user"),t.user=o.getObject("user"),e.vm.username="",localStorage.clear(),t.isLogin=!1,s.go("main.post.postList")):tools.alertError(t,"退出失败")},function(){tools.alertError(t,"退出失败")})),$("#userUpdateUser").modal("hide")):tools.alertError(t,a.data)})}},e.centerWindow=function(e,t,o,s){var a=(screen.width-o)/2,n=(screen.height-s)/2-50;window.open(e,t,"width="+o+",height="+s+",top="+n+",left="+a)}}]),myBbsCtrls.controller("userPostListController",["$scope","$rootScope","$cookies","$state","moduleServer","userServer","postServer",function(e,t,o,s,a,n,i){t.vm={tableFlag:0,bOff:!0,getUserPostList:{action:"getUserPostList",pageIndex:1,pageSize:15},userPostList:{}},e.init=function(){e.vm.bOff&&(e.vm.bOff=!1,i.service(e.vm.getUserPostList).then(function(t){t.status===!0?(e.vm.bOff=!0,angular.forEach(t.data,function(e){e.post_time=e.post_time,e.active=1==e.post_status,e.post_status=1==e.post_status?"通过":"未通过"}),e.vm.userPostList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getUserPostList.pageIndex=this.currentPage,e.vm.getUserPostList.pageSize=this.itemsPerPage,e.init()}},e.goPostDetail=function(e,o){window.localStorage.setItem("post_title",o),window.localStorage.setItem("post_id",e),t.vm.post_title=window.localStorage.getItem("post_title"),s.go("main.post.postDetail")}}]),myBbsCtrls.controller("userPostCollectionListController",["$scope","$rootScope","$cookies","$state","moduleServer","userServer","collectionServer",function(e,t,o,s,a,n,i){t.vm={tableFlag:0,bOff:!0,getPostCollectionList:{action:"getPostCollectionList",pageIndex:1,pageSize:15},postCollectionList:{}},e.init=function(){e.vm.bOff&&(e.vm.bOff=!1,i.service(e.vm.getPostCollectionList).then(function(t){t.status===!0?(e.vm.bOff=!0,e.vm.postCollectionList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getPostCollectionList.pageIndex=this.currentPage,e.vm.getPostCollectionList.pageSize=this.itemsPerPage,e.init()}},e.goPostDetail=function(e,o){window.localStorage.setItem("post_title",o),window.localStorage.setItem("post_id",e),t.vm.post_title=window.localStorage.getItem("post_title"),s.go("main.post.postDetail")},e.deleteCollection=function(o){e.vm.deleteCollection={action:"deleteCollection",id:o},i.service(e.vm.deleteCollection).then(function(o){o.status===!0?(tools.alertSuccess(t,"删除成功"),e.init()):tools.alertError(t,o.data)})}}]),myBbsCtrls.controller("userFriendListController",["$scope","$rootScope","$cookies","$state","moduleServer","userServer","friendServer","whispersServer",function(e,t,o,s,a,n,i,r){t.vm={tableFlag:0,tableFlagFriend:0,tableFlagWhispers:0,tabSwitch:"friend",bOff:!0,bOffWhispers:!0,loginUser:e.user.name,getIsUserFriendList:{action:"getIsUserFriendList",pageIndex:1,pageSize:10},getAddUserFriendList:{action:"getAddUserFriendList"},userFriendList:{},addFriendList:{}},e.init=function(){$("#friendAlert").hide(),e.vm.bOff&&(e.vm.bOff=!1,i.service(e.vm.getIsUserFriendList).then(function(t){t.status===!0?(e.vm.bOff=!0,e.vm.userFriendList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize,0==t.totalNum&&(e.vm.tableFlag=2)):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getIsUserFriendList.pageIndex=this.currentPage,e.vm.getIsUserFriendList.pageSize=this.itemsPerPage,e.init()}},e.initFriend=function(){i.service(e.vm.getAddUserFriendList).then(function(t){t.status===!0?(e.vm.bOff=!0,e.vm.addFriendList=t.data,e.vm.tableFlagFriend=1):e.vm.tableFlagFriend=2})},e.initFriend(),e.getWhispers=function(o,s,a){$(a.target).find("span").hide(),e.vm.bOffWhispers=!0,e.vm.tabSwitch="whispers",e.vm.getWhispersByUserId={action:"getWhispersByUserId",user_id:o,pageIndex:1,pageSize:10,noSetStatus:"no"},e.vm.whispersList={},e.initWhispers=function(){e.vm.bOffWhispers&&(e.vm.bOffWhispers=!1,r.service(e.vm.getWhispersByUserId).then(function(t){t.status===!0?(e.vm.bOffWhispers=!0,e.vm.whispersList=t.data,e.vm.tableFlagWhispers=1,e.paginationConfWhispers.totalItems=t.totalNum,e.paginationConfWhispers.currentPage=t.pageIndex,e.paginationConfWhispers.itemsPerPage=t.pageSize):e.vm.tableFlagWhispers=2}))},e.initWhispers(),e.paginationConfWhispers={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getWhispersByUserId.pageIndex=this.currentPage,e.vm.getWhispersByUserId.pageSize=this.itemsPerPage,e.initWhispers()}},e.vm.addWhispers={content:"",action:"addWhispers",to_user_id:o},e.addWhispers=function(){r.service(e.vm.addWhispers).then(function(o){o.status===!0?(tools.alertSuccess(t,o.data),e.vm.addWhispers.content="",e.vm.bOffWhispers=!0,e.vm.getWhispersByUserId.noSetStatus="yes",e.initWhispers()):tools.alertError(t,o.data)})},e.deleteWhispers=function(o){e.vm.deleteWhispers={action:"deleteWhispers",whispers_id:o},r.service(e.vm.deleteWhispers).then(function(o){o.status===!0?(tools.alertSuccess(t,"删除成功"),e.vm.bOffWhispers=!0,e.initWhispers()):tools.alertError(t,o.data)})},e.deleteFriend=function(){e.vm.deleteFriend={action:"deleteFriend",id:s},i.service(e.vm.deleteFriend).then(function(o){o.status===!0?(tools.alertSuccess(t,"删除成功"),e.vm.bOff=!0,e.init(),e.vm.tabSwitch="friend"):tools.alertError(t,o.data)})}},e.agreeFriend=function(o){e.vm.agreeFriend={action:"agreeFriend",id:o},i.service(e.vm.agreeFriend).then(function(o){o.status===!0?(tools.alertSuccess(t,"添加成功"),e.init(),e.initFriend()):tools.alertError(t,o.data)})},e.deleteFriend=function(o){e.vm.deleteFriend={action:"deleteFriend",id:o},i.service(e.vm.deleteFriend).then(function(o){o.status===!0?(tools.alertSuccess(t,"删除成功"),e.initFriend()):tools.alertError(t,o.data)})}}]),myBbsCtrls.controller("userMessageListController",["$scope","$rootScope","$cookies","$state","messageServer","friendServer","whispersServer","messageServer",function(e,t,o,s,a,n,i,a){e.vm={tableFlag:0,bOff:!0,messageList:{},getAllMessageByUserId:{action:"getAllMessageByUserId",pageIndex:1,pageSize:15}},e.init=function(){$("#messageAlert").hide(),e.vm.bOff&&(e.vm.bOff=!1,a.service(e.vm.getAllMessageByUserId).then(function(t){t.status===!0?(e.vm.bOff=!0,e.vm.messageList=t.data,e.vm.tableFlag=1,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getAllMessageByUserId.pageIndex=this.currentPage,e.vm.getAllMessageByUserId.pageSize=this.itemsPerPage,e.init()}},e.addFriendModalShow=function(o,s){$("#addFriend").modal("show"),e.vm.addFriend={name:s,desc:"跟我交朋友吧",action:"addFriend",to_user_id:o},e.addFriend=function(){""!=e.vm.addFriend.desc?e.vm.addFriend.desc.length>256?tools.alertError(t,"验证信息256字符"):n.service(e.vm.addFriend).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$("#addFriend").modal("hide")):tools.alertError(t,e.data)}):tools.alertError(t,"输入验证信息")}},e.addMessageModalShow=function(o,s){$("#addMessage").modal("show"),e.vm.addMessage={name:s,content:"",action:"addMessage",to_user_id:o},e.addMessage=function(){""!=e.vm.addMessage.content?e.vm.addMessage.content.length>256?tools.alertError(t,"留言不能大于256字符"):a.service(e.vm.addMessage).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$("#addMessage").modal("hide")):tools.alertError(t,e.data)}):tools.alertError(t,"留言不能为空")}},e.addWhispersModalShow=function(o,s){$("#addWhispers").modal("show"),e.vm.addWhispers={name:s,content:"",action:"addWhispers",to_user_id:o},e.addWhispers=function(){""!=e.vm.addWhispers.content?e.vm.addWhispers.content.length>256?tools.alertError(t,"私信不能大于256字符"):i.service(e.vm.addWhispers).then(function(e){e.status===!0?(tools.alertSuccess(t,e.data),$("#addWhispers").modal("hide")):tools.alertError(t,e.data)}):tools.alertError(t,"私信不能为空")}},e.deleteMessage=function(o){e.vm.deleteMessage={action:"deleteMessage",id:o},a.service(e.vm.deleteMessage).then(function(o){o.status===!0?(tools.alertSuccess(t,"删除成功"),e.init()):tools.alertError(t,o.data)})}}]),myBbsCtrls.controller("userIntegralListController",["$scope","$rootScope","$cookies","$state","integralServer",function(e,t,o,s,a){e.vm={tableFlag:0,bOff:!0,integralList:{},getAllIntegralListByUserId:{action:"getAllIntegralListByUserId",pageIndex:1,pageSize:15}},e.init=function(){e.vm.bOff&&(e.vm.bOff=!1,a.service(e.vm.getAllIntegralListByUserId).then(function(t){t.status===!0?(e.vm.bOff=!0,e.vm.integralList=t.data,e.vm.tableFlag=1,e.vm.totalIntegral=t.totalIntegral,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.getAllIntegralListByUserId.pageIndex=this.currentPage,e.vm.getAllIntegralListByUserId.pageSize=this.itemsPerPage,e.init()}}}]),myBbsCtrls.controller("moduleController",["$scope","$rootScope","$cookies","$state","moduleServer",function(e,t,o,s,a){window.localStorage.removeItem("searchType"),window.localStorage.removeItem("searchText"),e.vm={moduleList:{},postData:{action:"getAllListNoLimt"}},a.service(e.vm.postData).then(function(t){t.status===!0&&(e.vm.moduleList=t.data)}),e.goPostList=function(e,t){window.localStorage.setItem("module_id",e),window.localStorage.setItem("module_name",t),s.go("main.post.postList")}}]),myBbsCtrls.controller("searchController",["$scope","$rootScope","$cookies","$state","searchServer",function(e,t,o,s,a){e.vm={tableFlag:0,bOff:!0,searchList:{},doSearch:{action:"doSearch",searchType:window.localStorage.getItem("searchType")||"帖子",searchText:window.localStorage.getItem("searchText")||"",pageIndex:1,pageSize:15}},e.init=function(){e.vm.bOff&&(e.vm.bOff=!1,a.service(e.vm.doSearch).then(function(t){t.status===!0?(e.vm.bOff=!0,e.vm.searchList=t.data,e.vm.tableFlag=1,e.vm.totalIntegral=t.totalIntegral,e.paginationConf.totalItems=t.totalNum,e.paginationConf.currentPage=t.pageIndex,e.paginationConf.itemsPerPage=t.pageSize):e.vm.tableFlag=2}))},e.init(),e.paginationConf={currentPage:0,totalItems:0,itemsPerPage:0,onChange:function(){e.vm.doSearch.pageIndex=this.currentPage,e.vm.doSearch.pageSize=this.itemsPerPage,e.init()}},e.goPostDetail=function(e,o){window.localStorage.setItem("post_title",o),window.localStorage.setItem("post_id",e),s.go("main.post.postDetail"),t.vm.post_title=window.localStorage.getItem("post_title")}}]);